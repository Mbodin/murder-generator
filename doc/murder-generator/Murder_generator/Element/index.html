<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Element (murder-generator.Murder_generator.Element)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">murder-generator</a> &#x00BB; <a href="../index.html">Murder_generator</a> &#x00BB; Element</nav><h1>Module <code>Murder_generator.Element</code></h1></header><aside><p>Module Element Data structure and functions about story elements.</p></aside><dl><dt class="spec type" id="type-character"><a href="#type-character" class="anchor"></a><code><span class="keyword">type</span> character</code><code> = <a href="../State/index.html#type-character">State.character</a></code></dt><dt class="spec type" id="type-id"><a href="#type-id" class="anchor"></a><code><span class="keyword">type</span> id</code><code> = <span><span>(int, int)</span> Libutils.Utils.sum</span></code></dt><dd><p>References to characters and objects in an element are done using this type. <code>Left i</code> corresponds to the <code>i</code>th character of the element, and <code>Right i</code> to the <code>i</code>th object. The type <code>id option</code> is also frequently used in this file. In such case, <code>None</code> means that it targets all the other characters of the element (declared as <code>let any other player</code> in the data files).</p></dd></dl><dl><dt class="spec type" id="type-cconstraint"><a href="#type-cconstraint" class="anchor"></a><code><span class="keyword">type</span> cconstraint</code><code> = </code><table class="variant"><tr id="type-cconstraint.Attribute" class="anchored"><td class="def constructor"><a href="#type-cconstraint.Attribute" class="anchor"></a><code>| </code><code><span class="constructor">Attribute</span> <span class="keyword">of</span> <a href="../Attribute/PlayerAttribute/index.html#type-attribute">Attribute.PlayerAttribute.attribute</a> * <span><a href="../Attribute/PlayerAttribute/index.html#type-constructor">Attribute.PlayerAttribute.constructor</a> <a href="../State/index.html#type-attribute_value">State.attribute_value</a></span></code></td><td class="doc"><p>The given attribute value is provided by the element. Note that <code>State.attribute_constructor</code> can be of the form <code>State.One_value_of</code>, in which case the attribute is required to be of this value, but also <code>State.Fixed_value</code>, where the element actually provides an explanation for it.</p></td></tr><tr id="type-cconstraint.Contact" class="anchored"><td class="def constructor"><a href="#type-cconstraint.Contact" class="anchor"></a><code>| </code><code><span class="constructor">Contact</span> <span class="keyword">of</span> <a href="../Attribute/ContactAttribute/index.html#type-attribute">Attribute.ContactAttribute.attribute</a> * <span><a href="index.html#type-id">id</a> option</span> * <span><a href="../Attribute/ContactAttribute/index.html#type-constructor">Attribute.ContactAttribute.constructor</a> <a href="../State/index.html#type-attribute_value">State.attribute_value</a></span></code></td><td class="doc"><p>The given contact (identified in the local array) is provided by the element.</p></td></tr></table></dt><dd><p>A constraint on a character</p></dd></dl><dl><dt class="spec type" id="type-cell"><a href="#type-cell" class="anchor"></a><code><span class="keyword">type</span> cell</code><code> = </code><code>{</code><table class="record"><tr id="type-cell.constraints" class="anchored"><td class="def field"><a href="#type-cell.constraints" class="anchor"></a><code>constraints : <span><a href="index.html#type-cconstraint">cconstraint</a> list</span>;</code></td><td class="doc"><p>The constraints on this character.</p></td></tr><tr id="type-cell.relations" class="anchored"><td class="def field"><a href="#type-cell.relations" class="anchor"></a><code>relations : <span><a href="../Relation/index.html#type-t">Relation.t</a> array</span>;</code></td><td class="doc"><p>The relations that would be added to this character, for each other characters of the element. This array can be less than the number of players in this element (<code>Neutral</code> is then assumed for all other cells).</p></td></tr><tr id="type-cell.added_objective" class="anchored"><td class="def field"><a href="#type-cell.added_objective" class="anchor"></a><code>added_objective : <a href="../State/index.html#type-objective">State.objective</a>;</code></td><td class="doc"><p>Some difficulty or complexity, provided in addition to the ones naturally provided by the relations.</p></td></tr></table><code>}</code></dt><dd><p>All the changes applied by an elements to players are summed up in this type.</p></dd></dl><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code><code> = </code><code>{</code><table class="record"><tr id="type-t.status" class="anchored"><td class="def field"><a href="#type-t.status" class="anchor"></a><code>status : <a href="../History/index.html#type-status">History.status</a>;</code></td></tr><tr id="type-t.players" class="anchored"><td class="def field"><a href="#type-t.players" class="anchor"></a><code>players : <span><a href="index.html#type-cell">cell</a> array</span>;</code></td></tr><tr id="type-t.others" class="anchored"><td class="def field"><a href="#type-t.others" class="anchor"></a><code>others : <span><a href="index.html#type-cconstraint">cconstraint</a> list</span>;</code></td></tr><tr id="type-t.objects" class="anchored"><td class="def field"><a href="#type-t.objects" class="anchor"></a><code>objects : <span><span><a href="index.html#type-cconstraint">cconstraint</a> list</span> array</span>;</code></td></tr><tr id="type-t.events" class="anchored"><td class="def field"><a href="#type-t.events" class="anchor"></a><code>events : <span><span>int <a href="../Events/index.html#type-t">Events.t</a></span> list</span>;</code></td></tr><tr id="type-t.id" class="anchored"><td class="def field"><a href="#type-t.id" class="anchor"></a><code>id : Libutils.Id.t;</code></td></tr></table><code>}</code></dt><dd><p>Each players considered by the element are represented as a cell. A list of constraints given to other characters is also given (it corresponds to the <code>let any other player</code> declarations. Events are stored as a list, characters being represented by their index in the cell array. In addition to characters declaration, an element also containts object declarations, associated with their constraints. Events must not be directly contradictory: if an event has a constraint preventing an event of a given kind to be after this event, it must not be after it in the list. Finally, a unique identifier for each event is provided.</p></dd></dl><dl><dt class="spec value" id="val-provided_attributes"><a href="#val-provided_attributes" class="anchor"></a><code><span class="keyword">val</span> provided_attributes : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="../Attribute/index.html#type-attribute">Attribute.attribute</a> list</span></code></dt><dd><p>Returns the list of attribute that an element may provide.</p></dd></dl><dl><dt class="spec value" id="val-compatible_and_progress"><a href="#val-compatible_and_progress" class="anchor"></a><code><span class="keyword">val</span> compatible_and_progress : <a href="../Attribute/index.html#type-constructor_maps">Attribute.constructor_maps</a> <span>&#45;&gt;</span> <a href="../State/index.html#type-t">State.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="index.html#type-character">character</a> array</span> <span>&#45;&gt;</span> <span><span>bool Stdlib.Lazy.t</span> option</span></code></dt><dd><p>Given a state, an element, and an instantiation of the characters, states whether the event can be applied. If not, it returns <code>None</code>. If the element can be applied, it states whether the element is making progress, that is whether there exists at least one attribute value that has been changed to something recognised by <code>State.attribute_value_progress</code>. The boolean is lazily evaluated.</p></dd></dl><dl><dt class="spec value" id="val-is_translatable"><a href="#val-is_translatable" class="anchor"></a><code><span class="keyword">val</span> is_translatable : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../Translation/index.html#type-language">Translation.language</a> <span>&#45;&gt;</span> bool</code></dt><dd><p>Given an element and a language, states whether it can be safely translated into a given language (that is, whether the language is listed amongst all its translations and that default cases are well-handled in these translations).</p></dd></dl><dl><dt class="spec type" id="type-cache"><a href="#type-cache" class="anchor"></a><code><span class="keyword">type</span> cache</code></dt><dd><p>To speed-up the search for instantiation, a cache is left in the state. This type describes this cache.</p></dd></dl><dl><dt class="spec value" id="val-empty_cache"><a href="#val-empty_cache" class="anchor"></a><code><span class="keyword">val</span> empty_cache : <a href="index.html#type-cache">cache</a></code></dt><dd><p>An empty cache to be used at initialisation.</p></dd></dl><dl><dt class="spec value" id="val-search_instantiation"><a href="#val-search_instantiation" class="anchor"></a><code><span class="keyword">val</span> search_instantiation : <a href="../Attribute/index.html#type-constructor_maps">Attribute.constructor_maps</a> <span>&#45;&gt;</span> <span><span>(<a href="../State/index.html#type-t">State.t</a>, <a href="index.html#type-cache">cache</a>)</span> Libutils.Utils.cached</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><span>(<span><a href="index.html#type-character">character</a> array</span> * bool)</span> option</span></code></dt><dd><p>Look for instantiations. The second return value is the result of <code>compatible_and_progress</code> on this nstantiation. It tries to return an instantiation that progresses.</p></dd></dl><dl><dt class="spec type" id="type-attribute_differences"><a href="#type-attribute_differences" class="anchor"></a><code><span class="keyword">type</span> attribute_differences</code></dt><dd><p>This type carries information about how the state have been changed by the <code>apply</code> function.</p></dd></dl><dl><dt class="spec value" id="val-merge_attribute_differences"><a href="#val-merge_attribute_differences" class="anchor"></a><code><span class="keyword">val</span> merge_attribute_differences : <a href="index.html#type-attribute_differences">attribute_differences</a> <span>&#45;&gt;</span> <a href="index.html#type-attribute_differences">attribute_differences</a> <span>&#45;&gt;</span> <a href="index.html#type-attribute_differences">attribute_differences</a></code></dt><dd><p>Compose two differences of attribute. The function is optimised for when the first argument is larger than the second.</p></dd></dl><dl><dt class="spec value" id="val-difference_weigth"><a href="#val-difference_weigth" class="anchor"></a><code><span class="keyword">val</span> difference_weigth : <a href="index.html#type-attribute_differences">attribute_differences</a> <span>&#45;&gt;</span> int</code></dt><dd><p>Returns some value of the weight of the difference of attributes after the application of an event. A difference of zero means that as many constraints have been solved than constraints that have been added. Negative values means that more constraints have been added than solved, and positive means that more have been solved.</p></dd></dl><dl><dt class="spec value" id="val-difference_for_attribute"><a href="#val-difference_for_attribute" class="anchor"></a><code><span class="keyword">val</span> difference_for_attribute : <a href="index.html#type-attribute_differences">attribute_differences</a> <span>&#45;&gt;</span> <a href="../Attribute/index.html#type-attribute">Attribute.attribute</a> <span>&#45;&gt;</span> int</code></dt><dd><p>Returns the difference for a specific attribute.</p></dd></dl><dl><dt class="spec value" id="val-difference_attribute_in_need"><a href="#val-difference_attribute_in_need" class="anchor"></a><code><span class="keyword">val</span> difference_attribute_in_need : <a href="index.html#type-attribute_differences">attribute_differences</a> <span>&#45;&gt;</span> <span><a href="../Attribute/index.html#type-attribute">Attribute.attribute</a> list</span></code></dt><dd><p>Returns all attributes who value associated by <code>difference_for_attribute</code> is negative, that is, the attributes with constraints to be solved.</p></dd></dl><dl><dt class="spec value" id="val-empty_difference"><a href="#val-empty_difference" class="anchor"></a><code><span class="keyword">val</span> empty_difference : <a href="index.html#type-attribute_differences">attribute_differences</a></code></dt><dd><p>Return an empty difference, with a weight of zero.</p></dd></dl><dl><dt class="spec value" id="val-apply"><a href="#val-apply" class="anchor"></a><code><span class="keyword">val</span> apply : <a href="../Attribute/index.html#type-constructor_maps">Attribute.constructor_maps</a> <span>&#45;&gt;</span> <a href="../State/index.html#type-t">State.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="index.html#type-character">character</a> array</span> <span>&#45;&gt;</span> <a href="../State/index.html#type-t">State.t</a> * <a href="index.html#type-attribute_differences">attribute_differences</a></code></dt><dd><p>Apply the given element to the state according to this instantiation. This application is not functional (although the new state is returned, invalidating the previous one). This function should only be applied to instantiations for which <code>compatible_and_progress</code> returns <code>Some</code>. Once the total number of attribute to be defined is zero, the state can be published.</p></dd></dl><dl><dt class="spec value" id="val-safe_apply"><a href="#val-safe_apply" class="anchor"></a><code><span class="keyword">val</span> safe_apply : <a href="../Attribute/index.html#type-constructor_maps">Attribute.constructor_maps</a> <span>&#45;&gt;</span> <a href="../State/index.html#type-t">State.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="index.html#type-character">character</a> array</span> <span>&#45;&gt;</span> <a href="../State/index.html#type-t">State.t</a> * <a href="index.html#type-attribute_differences">attribute_differences</a></code></dt><dd><p>Same as <code>apply</code>, but create a copy of the state before the application.</p></dd></dl><dl><dt class="spec value" id="val-apply_relations"><a href="#val-apply_relations" class="anchor"></a><code><span class="keyword">val</span> apply_relations : <a href="../State/index.html#type-relation_state">State.relation_state</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="index.html#type-character">character</a> array</span> <span>&#45;&gt;</span> <a href="../State/index.html#type-relation_state">State.relation_state</a></code></dt><dd><p>Get the resulting relation state from an instantiation. The input state is not modified by this function.</p></dd></dl><dl><dt class="spec value" id="val-apply_attributes"><a href="#val-apply_attributes" class="anchor"></a><code><span class="keyword">val</span> apply_attributes : <a href="../Attribute/index.html#type-constructor_maps">Attribute.constructor_maps</a> <span>&#45;&gt;</span> <a href="../State/index.html#type-t">State.t</a> <span>&#45;&gt;</span> <a href="index.html#type-character">character</a> <span>&#45;&gt;</span> <span><a href="../Attribute/PlayerAttribute/index.html#type-constructor">Attribute.PlayerAttribute.constructor</a> list</span> <span>&#45;&gt;</span> <span><span>(<a href="../State/index.html#type-t">State.t</a> * <a href="index.html#type-attribute_differences">attribute_differences</a>)</span> option</span></code></dt><dd><p>Apply the attributes to a given character. These constructors will be applied with the <code>State.One_value_of</code> constructor.</p></dd></dl><dl><dt class="spec value" id="val-apply_contacts"><a href="#val-apply_contacts" class="anchor"></a><code><span class="keyword">val</span> apply_contacts : <a href="../Attribute/index.html#type-constructor_maps">Attribute.constructor_maps</a> <span>&#45;&gt;</span> <a href="../State/index.html#type-t">State.t</a> <span>&#45;&gt;</span> <a href="index.html#type-character">character</a> <span>&#45;&gt;</span> <a href="index.html#type-character">character</a> <span>&#45;&gt;</span> <span><a href="../Attribute/ContactAttribute/index.html#type-constructor">Attribute.ContactAttribute.constructor</a> list</span> <span>&#45;&gt;</span> <span><span>(<a href="../State/index.html#type-t">State.t</a> * <a href="index.html#type-attribute_differences">attribute_differences</a>)</span> option</span></code></dt><dd><p>Apply the contacts to a given source and target characters. These constructors will be applied with the <code>State.One_value_of</code> constructor.</p></dd></dl></div></body></html>